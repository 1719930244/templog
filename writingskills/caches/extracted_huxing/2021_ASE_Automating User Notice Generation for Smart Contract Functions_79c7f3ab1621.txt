Automating User Notice Generation for Smart
Contract Functions
Xing Hu‚àó‚à•, Zhipeng Gao‚Ä†, Xin Xia‚Ä†¬∂, David Lo‚Ä° and Xiaohu Yang¬ß
‚àóSchool of Software Technology, Zhejiang University, Ningbo, China
‚Ä†Faculty of Information Technology, Monash University, Melbourne, Australia
‚Ä° School of Information Systems, Singapore Management University, Singapore, davidlo@smu.edu.sg
¬ßCollege of Computer Science and Technology, Zhejiang University, Hangzhou, China
{xinghu,yangxh}@zju.edu.cn,{zhipeng.gao,Xin.Xia}@monash.edu, davidlo@smu.edu.sg
Abstract‚ÄîSmart contracts have obtained much attention and
are crucial for automatic Ô¨Ånancial and business transactions. For
end-users who have never seen the source code, they can read
the user notice shown in end-user client to understand what
a transaction does of a smart contract function. However, due
to time constraints or lack of motivation, user notice is often
missing during the development of smart contracts. For end-
users who lack the information of the user notices, there is no
easy way for them to check the code semantics of the smart
contracts. Thus, in this paper, we propose a new approach
SMART DOC to generate user notice for smart contract functions
automatically. Our tool can help end-users better understand
the smart contract and aware of the Ô¨Ånancial risks, improving
the users‚Äô conÔ¨Ådence on the reliability of the smart contracts.
SMART DOC exploits the Transformer to learn the representation
of source code and generates natural language descriptions
from the learned representation. We also integrate the Pointer
mechanism to copy words from the input source code instead
of generating words during the prediction process. We extract
7,878 ‚ü®f unction, notice‚ü© pairs from 54,739 smart contracts
written in Solidity. Due to the limited amount of collected
smart contract functions (i.e., 7,878 functions), we exploit a
transfer learning technique to utilize the learned knowledge to
improve the performance of SMART DOC. The learned knowledge
obtained by the pre-training on a corpus of Java code, that
has similar characteristics as Solidity code. The experimental
results show that our approach can effectively generate user
notice given the source code and signiÔ¨Åcantly outperform the
state-of-the-art approaches. To investigate human perspectives on
our generated user notice, we also conduct a human evaluation
and ask participants to score user notice generated by different
approaches. Results show that SMART DOC outperforms baselines
from three aspects, naturalness, informativeness, and similarity.
Index Terms‚ÄîSmart Contract, User Notice Generation, Deep
Learning
I. I NTRODUCTION
Recent years have seen an emerging interest in cryptocur-
rencies (e.g., Bitcoin and Ethereum) on distributed ledgers
(a.k.a., Blockchains [1]) from both industry and academia.
As one of the largest cryptocurrency platform [2], Ethereum
has become a widely used platform to enable Ô¨Ånancial and
business transactions. As the core of Ethereum [3], smart
contracts [4][5] are Turing-complete programs and executed
‚à•Also with PengCheng Laboratory.¬∂Corresponding author.
on the Ethereum Blockchain. After the deployment, the end-
users can interact with a smart contract by sending transactions
to its functions. Each transaction consumes a certain amount of
‚Äúgas‚Äù whose price is given in Ethereum cryptocurrency named
Ether ($737.15 per unit of Ether as of Dec 2020 [6]). Due
to the high stakes of smart contracts and the potential risk
of Ô¨Ånancial loss for users, it is necessary to assist end-users
better understand the functionality of smart contracts.
Two groups of people interact with smart contracts: de-
velopers and end-users. When developers implement a smart
contract, they need to translate Ô¨Ånancial operations (e.g.,
transfer) into one or more contract transactions; then the end-
users start the transaction which triggers the execution of a
function deÔ¨Åned within the smart contract. In this study, we
argue that the end-users are often non-tech-savvy consumers
of the contracts. To assist these users who cannot read the
source code, Solidity (one of the most popular programming
language for smart contracts) provides a mechanism that can
provide notices for end-users. An example of a smart contract
function and how it is used by an end-user are illustrated
in Figure 1 and Figure 2. Consider Alice is an end-user of
smart contracts who knows nothing about programming; when
she submits a transaction to the above function with a target
address of 0x83***Cc and ‚ÄúmintedAmount‚Äù of 100, then
the user notice will be rendered to Alice as: ‚Äú Create 100
tokens and send it to 0x83 ***Cc‚Äù. After reading
the user notice, Alice can better understand the contract and
thus can better make informed decision, i.e., Reject or ConÔ¨Årm
the transaction.
Unfortunately, user notices are often lacking for a large
number of smart contracts. Even though the ofÔ¨Åcial guide
line of Solidity recommends that the smart contracts should
be annotated with user notice for all public interfaces, this
practice is often neglected or ignored by developers during
smart contract development. This will make the end-users
completely clueless and uninformed, which may discourage
the participation of end-users and the usability of the smart
contract. Moreover, due to the unalterable feature of the
blockchain system, unlike traditional software, user notice can
not be added once the smart contract is deployed. Therefore, it
is desirable to have a tool that can automatically generate user
notices for smart contract developers whenever they forget to
SourceCode:
/// @noticeCreate `mintedAmount` tokens and send it to `target`
functionmintToken(addresstarget,uint256mintedAmount) onlyOwnerpublic{
balanceOf[target] +=mintedAmount;
totalSupply+=mintedAmount;
Transfer(0,this,mintedAmount);
Transfer(this,target,mintedAmount);
}
Fig. 1. An example of a smart contract function
do so.
Existing approaches mainly focus on generating comments
for common programming languages, e.g., Java and Python.
These comments are provided to developers and help them to
understand the source code. However, generating comments
especially user-oriented comments (i.e., user notices) has not
gained much attention yet. Making such a tool for smart con-
tracts is a non-trivial task considering the following challenges:
(i) Dynamic Expressions Mechanism. The user notice in
smart contracts supports dynamic expressions. Different from
the general code comments of other programming languages
(e.g., Java comments), the Solidity compiler produces the
user notice dynamically from the source code. The dynamic
expression mechanism requires that certain words in the user
notice should be identical with the corresponding tokens in
source code. For the example shown in Figure 1, the word
‚Äú mintedAmount‚Äù and ‚Äú target‚Äù are both copied from the
source code. This mechanism causes the user notice to be
closely related to the source code. Even though the existing
documentation generation approaches have achieved a huge
success for general code comments generation (e.g., comments
for Java method [7][8][9][10][11]), it is not clear whether
they can be successfully applied to user notice generation
for smart contracts. How to copy variable names correctly
from the smart contracts is still challenging for these deep
learning models. (ii) Data Hungry. Compared with other
popular programming languages (i.e., Java), it is more difÔ¨Åcult
to collect large-scale datasets for smart contracts. Even though
the Ethereum blockchain has accumulated a great number
of smart contracts, data hungry problem still exists. That
is, only a small proportion of smart contracts have user
notices. According to our preliminary study, only 11,409 out
of 54,739 smart contracts contain user notices; if we look at
the functions, the proportion is even smaller. How to utilize
the limited labeled data for generating accurate user notice is
challenging for this work.
In this paper, we propose a new approach named S MART-
DOC to address the aforementioned challenges. We aim to
understand functions in smart contracts and automatically
generate user notices (i.e., @notice) for functions in a smart
contracts. The main idea of our approach is two-folds: (1)
while generating user notice, S MART DOC can predict a word
or copy a token from source code. It exploits Transformer [12]
equipped with Pointer mechanism to predict user notice. Exist-
ing code comment generation approaches usually use Recur-
rent Neural Network (e.g., LSTM and GRU) to generate code
comments. However, these techniques are difÔ¨Åcult to capture
long-range dependencies between code tokens. In this paper,
we exploit the Transformer architecture that can generate user
#M 
!&$&M&$&!M

&%M&M
'&!M0LQW7RNHQ
KM+5;MC3/@/E:M/DG<L7
 I0M
	M
&UHDWHWRNHQVDQGVHQGLWWR
[FHHH$HH(E%&%
D'IG(&&F
0LQW7RNHQ
(M&MM*&%M
[HIDEEGFEIEFEIIHHG
FFIEGEGEEI

7DUJHW [FHHH$HH(E%&
%D'IG(&&F
#M 
!&$&M&$&!M

&%M&M
'&!&1RW)RXQG
KM+5;MC3/@/E:M/DG<L7
 I0M
	M
(M&MM*&%M
[HIDEEGFEIEFEIIHHG
FFIEGEGEEI

Fig. 2. An example of an end-user submitting a transaction with (on the
right) and without (on the left) user notice
notices to reinforce the capability of capturing the long-range
dependencies between code tokens. Considering the dynamic
expression mechanism, many words in the user notice can
be copied from the smart contract functions. Therefore, we
integrate the Pointer generator in our approach to overcome
the Ô¨Årst challenge. The Pointer mechanism can copy a word
by pointing tokens in source code. (2) In order to alleviate the
limitation of minimal labeled data, we propose to use transfer
learning [13] that transfers the knowledge of general comment
generation for Java methods into user notice generation for
smart contract functions. Solidity and Java languages are
somewhat similar in that both are object-oriented and high-
level programming languages. Models that have learnt how to
convert Java methods into comments can be a good start to
the user notice generation.
To evaluate our proposed model, we extract 7,878
‚ü®function,notice‚ü© pairs from 54,739 veriÔ¨Åed smart con-
tract. The automatic evaluation results show that S MART DOC
achieves the best performance when compared with baselines
including attendgru [11], ast-attendgru [11], and Re 2Com [10]
regarding the he BLEU score and ROUGE-L score. To explore
the practitioners‚Äô perspective on the generated notice, we also
conduct a human evaluation. Each practitioner is asked to
evaluate user notice generated by various approaches from
three aspects, the similarity of generated notice and human-
written notice, naturalness (grammatical correctness and Ô¨Çu-
ency) of the generated notices, and their informativeness (the
amount of content carried over from the input code to the
generated notices, ignoring Ô¨Çuency of the text). Experiments
show that our approach can achieve the best performance when
compared to the baseline techniques.
The main contributions of this paper are as follows:
‚Ä¢ We are the Ô¨Årst to investigate characteristics of smart
contract user notices. Our study highlights a problem
that has been neglected in the literature but has practical
implications.
‚Ä¢ We propose a novel approach S MART DOC for smart
contract user notice generation, which aims to help end-
users understand smart contracts when they are executed
in Blockchain platforms.
‚Ä¢ We integrate the Pointer mechanism into Transformer for
better user notice prediction. The approach can generate
words or copy tokens from source code. We exploit
transfer learning to alleviate the effect of minimal labeled
data on training a deep learning model. The experimental
results show that our approach outperforms the state-of-
the-art techniques.
‚Ä¢ We build the Ô¨Årst dataset with respect to user notice which
contains 7,878 ‚ü®function,notice‚ü© pairs. To the best of
our knowledge, this is the Ô¨Årst dataset of user notices for
smart contract functions.
This paper is organized as follows. In Section II, we provide
the preliminaries of smart contracts. Section III presents our
approach for smart contract user notice generation. Section
IV evaluates our approach on actual contracts collected from
the Ethereum blockchain. Section V and Section VI illustrate
experimental results and practitioners‚Äô perspectives on the
generated user notice. Section VII discusses our proposed
approach. Section IX presents the related works. Section X
concludes the paper.
II. P RELIMINARIES
In this section, we present the data hungry issue related
to user notices. Then, we show the correlation between user
notice and transactions .
A. User notice hungry
Ethereum [14] has attracted increasing attention as
a blockchain platform and smart contracts deployed on
Ethereum have been applied to many business domains to
enable efÔ¨Åcient and trustable transactions [15], [16]. When
developing smart contracts, Solidity provides a special form
of comments, named the Ethereum Natural Language Spec-
iÔ¨Åcation Format (NatSpec), to document contracts and func-
tions [17]. The @notice tag is the main NatSpec tag and
its audience is end-users. Considering that smart contract end-
users are often non-tech-savvy consumers, the user notices can
bridge the information gap between smart contract developers
and end-users. By interacting with the user notices, the end-
users can better assess the Ô¨Ånancial risks and make better
informed decisions. However, according to our preliminary
study, only a small proportion of smart contracts include user
notices. For example, among the 54,739 contracts that we have
collected, only 11,409 of them contain user notices; moreover,
only 4% of the functions in smart contracts have user notices.
B. User notice & Transactions
In smart contracts, functions are the executable units of
code and can be called by end-users. Intuitively, user notice of
functions can help end-users understand the smart contracts,
and thus improve the probability of smart contracts‚Äô trans-
actions. To verify this conjecture, we collect the transaction
information of smart contracts and investigate whether smart
contracts with user notice have more transactions. Figure 3
presents the function distribution in smart contracts and the
the distribution of the average amount of transactions of smart
0 10 20 30 40 50
The number of functions in the smart contracts
0
10000
20000
30000
40000
50000The number of smart contracts
(a) Function distribution in Smart
Contracts
0 5 10 15 20 25 30 35 40
# of functions with @notice tags
0
1000
2000
3000
4000
5000
6000
7000
8000Average Transactions
(b) The average amount of transac-
tions of Smart Contracts with differ-
ent amount of user notice
Fig. 3. Function Distribution and the Transaction Distribution of Smart
Contracts.
Contract Name: SMT
Transactions: 58,785
contractToken{
...
/// @noticesend `_value` token to `_to` from `msg.sender`
/// ...
functiontransfer(address_to,uint256_value) publicreturns(boolsuccess);
/// @noticesend `_value` token to `_to` from `_from` on the condition it is approved by `_from`
/// ...
functiontransferFrom(address_from,address_to,uint256_value) publicreturns(boolsuccess);
...
}
Contract Name: LooksCoin
Transactions: 25
contractERC20{
...
functiontransfer(address_to,uint256_value) publicreturns(boolsuccess);
functiontransferFrom(address_from,address_to,uint256_value) publicreturns(boolsuccess);
...
}
Fig. 4. Motivating Examples
contracts with different amount of user notice. From Figure
3(a), we can observe that almost all smart contracts have
less than 40 functions. Thus, we analyze the transactions of
them and Ô¨Ånd that smart contracts with more user notices
tend to have more transactions (shown in Figure 3(b)). This
is reasonable because detailed user notices can make end-
users well aware of the Ô¨Ånancial risks and improve the users‚Äô
conÔ¨Ådence in the reliability of the smart contracts, therefore
end-users prefer to start a transaction through smart contracts
with more high-quality user notices.
Figure 4 shows the source code of two smart contracts, i.e.,
SMT [18] and LooksCoin [19], in which SMT has 58,785
transactions and LooksCoin has 25 transactions. Although
these two smart contracts implemented the same functions,
such as transfer and transferFrom in this example, the
SMT contract provided adequate user notices while LooksCoin
did not make any notice for end-users. The detailed user notice
can help end-users better understand of their operations and
thus make the smart contract more popular among end-users.
III. A PPROACH
Figure 5 illustrates the overall framework of our approach
SMART DOC. It mainly consists of three phases: pre-training,
Ô¨Åne-tuning, and application. In the pre-training phase, we
exploit the Java dataset prepared by Hu et al. [9] to pre-train
the model of S MART DOC. Similar to Java, Solidity is also an
object-oriented programming language. The two programming
languages share similar coding conventions and syntax. There-
fore, the knowledge (such as variable naming conventions,
sequential information among code tokens) learned from Java
can be reused into Solidity. To better exploit the existing
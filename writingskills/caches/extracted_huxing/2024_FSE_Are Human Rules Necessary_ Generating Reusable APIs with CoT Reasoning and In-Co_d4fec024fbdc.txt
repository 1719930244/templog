Are Human Rules Necessary? Generating Reusable APIs with
CoT Reasoning and In-Context Learning
YUBO MAI, The State Key Laboratory of Blockchain and Data Security, Zhejiang University, China
ZHIPENG GAO∗, Shanghai Institute for Advanced Study of Zhejiang University, China
XING HU, The State Key Laboratory of Blockchain and Data Security, Zhejiang University, China
LINGFENG BAO, The State Key Laboratory of Blockchain and Data Security, Zhejiang University, China
YU LIU, The State Key Laboratory of Blockchain and Data Security, Zhejiang University, China
JIANLING SUN, The State Key Laboratory of Blockchain and Data Security, Zhejiang University, China
Nowadays, more and more developers resort to Stack Overflow for solutions (e.g., code snippets) when they
encounter technical problems. Although domain experts provide huge amounts of valuable solutions in Stack
Overflow, these code snippets are often difficult to reuse directly. Developers have to digest the information
within relevant posts and make necessary modifications, and the whole solution-seeking process can be
time-consuming and tedious. To facilitate the reuse of Stack Overflow code snippets, Terragni et al. first
explored transforming a code snippet in Stack Overflow into a well-formed method API (Application Program
Interface) by using a rule-based approach, named APIzator. The reported performance of their approach is
promising, however, after our in-depth analysis of their experiment results, we find that (1) 92.5% of APIs
generated by APIzator are pointless and thus are difficult to use in practice. This is because the method name
generated by APIzator (extracting verb + object ) can rarely represent the method’s functionality, which can
hardly be claimed as meaningful/reusable APIs. (2) The authors manually summarized a number of rules to
identify parameter variables and return statements for Java methods. These hand-crafted rules are extremely
complex and sophisticated, and the manual rule design process is labor-intensive and error-prone. Moreover,
since these rules are designed for Java, they can hardly be extended to other programming languages.
Inspired by the great potential of Large Language Models (LLMs) for solving complex coding tasks, in
this paper, we propose a novel approach, named Code2API, to automatically perform APIzation for Stack
Overflow code snippets. Code2API does not require additional model training or any manual crafting rules
and can be easily deployed on personal computers without relying on other external tools. Specifically,
Code2API guides the LLMs through well-designed prompts to generate well-formed APIs for given code
snippets. To elicit knowledge and logical reasoning from LLMs, we used chain-of-thought (CoT) reasoning
and few-shot in-context learning, which can help the LLMs fully understand the APIzation task and solve it
step by step in a manner similar to a developer. Our evaluations show that Code2API achieves a remarkable
accuracy in identifying method parameters (65%) and return statements (66%) equivalent to human-generated
ones, surpassing the current state-of-the-art approach, APIzator, by 15.0% and 16.5% respectively. Moreover,
compared with APIzator, our user study demonstrates that Code2API exhibits superior performance in
∗This is the corresponding author
Authors’ Contact Information: Yubo Mai, The State Key Laboratory of Blockchain and Data Security, Zhejiang Univer-
sity, China, 12021077@zju.edu.cn; Zhipeng Gao, Shanghai Institute for Advanced Study of Zhejiang University, China,
zhipeng.gao@zju.edu.cn; Xing Hu, The State Key Laboratory of Blockchain and Data Security, Zhejiang University, China,
xinghu@zju.edu.cn; Lingfeng Bao, The State Key Laboratory of Blockchain and Data Security, Zhejiang University, China,
lingfengbao@zju.edu.cn; Yu Liu, The State Key Laboratory of Blockchain and Data Security, Zhejiang University, China,
3200103741@zju.edu.cn; JianLing Sun, The State Key Laboratory of Blockchain and Data Security, Zhejiang University,
China, sunjl@zju.edu.cn.
Permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee
provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and
the full citation on the first page. Copyrights for third-party components of this work must be honored. For all other uses,
contact the owner/author(s).
© 2024 Copyright held by the owner/author(s).
ACM 2994-970X/2024/7-ART104
https://doi.org/10.1145/3660811
Proc. ACM Softw. Eng., Vol. 1, No. FSE, Article 104. Publication date: July 2024.
arXiv:2405.03509v1  [cs.SE]  6 May 2024
104:2 Yubo Mai, Zhipeng Gao, Xing Hu, Lingfeng Bao, Yu Liu, and JianLing Sun
generating meaningful method names, even surpassing the human-level performance, and developers are
more willing to use APIs generated by our approach, highlighting the applicability of our tool in practice.
Finally, we successfully extend our framework to the Python dataset, achieving a comparable performance
with Java, which verifies the generalizability of our tool.
CCS Concepts: • Software and its engineering → API languages; • Computing methodologies →
Natural language processing .
Additional Key Words and Phrases: Stack Overflow, APIs, Large language models, Chain-of-thought, In-context
learning
ACM Reference Format:
Yubo Mai, Zhipeng Gao, Xing Hu, Lingfeng Bao, Yu Liu, and JianLing Sun. 2024. Are Human Rules Necessary?
Generating Reusable APIs with CoT Reasoning and In-Context Learning. Proc. ACM Softw. Eng. 1, FSE,
Article 104 (July 2024), 23 pages. https://doi.org/10.1145/3660811
1 INTRODUCTION
Stack Overflow (SO), one of the most popular Software Q&A (SQA) sites, plays an ever-increasing
role in helping developers to solve their daily technical problems. Among the vast amount of
knowledge shared on SO, code snippets hold particular significance as they are widely copied and
pasted by developers, offering practical solutions to their daily programming problems. However,
code snippets on SO are often unable to be used directly [45, 51, 64]. This is because SO code snippets
are mainly written for illustrative purposes and do not focus on reusing purposes (such as missing
import declarations) [32]. Creating a reusable API for the SO code snippet requires substantial effort
and is rather laborious and error-prone, even for accepted answers. Developers have to navigate
through and digest the SO posts, and apply ad hoc modifications on code snippets for their own
usage, such as carefully recovering missing import declarations, summarizing descriptive method
names, extracting proper method parameters and replacing them in method bodies, inferring return
statements and catching necessary exceptions. As reported by Terragni et al [52], it takes more
than four minutes for an experienced Java developer to build an API from a given SO code snippet.
Consider the Java code snippet in Fig. 1 as an example. The Java code snippet is posted by
an expert to solve the problem ”How to remove specific value from string array in java? ”. Making
this code snippet off the shelf is difficult which requires various necessary steps. (1) Recovering
missing import declarations. Missing variables, function definitions, or third-party dependencies
can cause code to crash during compilation, we thus need to recover missing import statements
(e.g., import java.util.regex.ArrayList; ) at first. (2) Generating a meaningful method name
that precisely describes what the method does. A good method name should be self-explained and
intention-revealing, which can make the method much easier to understand, as well as to find
and use. On the contrary, a meaningless method name can obscure the meaning of the code and
waste developers’ time for searching and reusing. Therefore, we need to create a descriptive and
meaningful method name (i.e., removeItemFromStringArray) for the code snippet. (3) Identifying
the method input parameters and abstracting them in code snippets. Extracting suitable variables as
input parameters can provide good scalability for API reusing. For example, the variablesstr_array
and item are identified as input parameters passing to the API method. (4) Inferring the return
statements. After identifying the input of the code snippet, we also need to infer and add output
(i.e., return str_array ) for the API method. (5) Create throws statements. To safely use the API,
it is necessary to declare exceptions that the method may throw. Finally, a skilled developer goes
through the above steps and successfully outputs a reusable API as shown in Fig. 1.
To automate the process of APIzation from SO code snippets, Terragni et al. [52] first proposed a
tool, named APIzator, to convert Java code snippets to compliable APIs that developers can easily
Proc. ACM Softw. Eng., Vol. 1, No. FSE, Article 104. Publication date: July 2024.
Generating Reusable APIs with CoT and In-Context Learning 104:3
APIzation conducted by skilled developer
Stack Overflow Code Snippet: How to remove specific value from string array in java?Reusable API
Recover import statementsCreate the method nameCreate the parameter listCreate return statementsCreate throws statements
12345
12
3
4
5
Fig. 1. Human APIzation of A SO Code Snippet.
incorporate. The authors carefully designed a number of rules for Java to identify the method input
parameters and return statements and employed the Part-Of-Speech (POS) Tagging technique
to generate method names. As a result, APIzator takes the SO Java code snippet as input, after
going through manually designed rules, APIzator outputs a compliable API as output. APIzator
achieved a promising performance, for 81.5% APIs generated by APIzator, either method parameters
or return statements are identical with ground truth. To understand the rationale for APIzator’s
good performance and its applicable scenario in practice, we conduct an in-depth analysis of their
evaluation results. We find that: (1) Most of the APIs generated by APIzator are hardly to be
applied in practice. According to our investigation, 90% of these APIs are not applicable. This
is because APIzator ignores the importance of meaningful names. APIzator generated method
names by naively using the verb and its object from question titles, which are often imprecise
and misleading. The inconsistency between method names and their implementations can confuse
developers and even cause the introduction of bugs in the future [48–50]. (2) The rules designed
for APIzator are too complex and specific, and can hardly generalize to other programming
languages. For example, APIzator heavily relies on tools (e.g., CSNIPPEX [51] and BAKER [46] for
recovering missing variables and type declarations) and complex rules (e.g., using PATT-const to
recognize hard-coded initializations), implementing APIzator and adjusting it to other programming
languages require a substantial manual effort. Therefore, the key research question we ask in this
work is: Can we design models to generate applicable APIs for SO code snippets and generalize to other
programming languages easily?
The recent success of ChatGPT [34] based on GPT-3.5 demonstrates the remarkable ability of large
language models (LLMs) [5, 54, 55, 57, 58, 68] to comprehend human questions and assist in coding-
related tasks.1 Inspired by the impressive capabilities of LLMs in code generation [6, 14, 15, 25, 31, 69],
in this work, we propose Code2API, a novel approach to automatically generate reusable and
applicable APIs for SO code snippets. Notably, the underlying approach of Code2API is prompt
engineering [13, 29], i.e., prompting the tasks to generate desired output, which is extremely
lightweight compared to rule-based methods with manually designed rules and ML-based methods
with massive training data. Code2API leverages few-shot learning [ 2, 11] and chain-of-
thought reasoning [26, 59] to elicit human knowledge and logical reasoning from LLMs to
accomplish the APIzation task in a manner similar to a skilled developer. Few-shot learning
aims to solve the problem of how to train a model from a small number of examples. Regarding
1https://platform.openai.com/docs/model-index-for-researchers
Proc. ACM Softw. Eng., Vol. 1, No. FSE, Article 104. Publication date: July 2024.
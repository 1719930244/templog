# Automating Zero-Shot Patch Porting for Hard Forks
# 自动化硬分叉的零样本补丁移植

**来源**: ISSTA 2024 | **作者**: Shengyi Pan 等

## 摘要
分叉（Forking）是代码复用的典型方式，但也导致了软件维护中的重复劳动——开发者需要在硬分叉之间移植补丁以修复相似的缺陷或实现相似的功能。由于源项目与硬分叉之间的实现差异，补丁移植十分复杂。本文首次尝试在零样本设置下自动化硬分叉的补丁移植，先对Vim到Neovim近十年的补丁移植进行实证研究，然后提出基于大语言模型的方法PPatHF。PPatHF包含缩减模块和移植模块，在310个Neovim补丁上的实验表明，PPatHF能正确移植42.3%的补丁，并自动化57%的手动编辑工作量。

## 引言核心
- 硬分叉共享初始代码库但实现逐渐分化，补丁无法直接复制粘贴，需要适配不同实现
- 当前补丁移植由开发者手动逐案完成，耗时且易出错，超过50%的补丁延迟超过180天
- 安全补丁的移植延迟带来严重安全风险——漏洞公开后，未修补的分叉面临零日攻击
- 现有工具（如git apply）无法处理硬分叉间的显著差异，FixMorph等方法仅在语法层面抽象
- LLM在理解代码语义和零样本泛化方面的优势使其成为解决此问题的理想方案

## 方法概述
PPatHF以函数为粒度进行补丁移植，包含两个模块。缩减模块首先精简输入函数，移除与补丁关联度低的代码片段，使更多补丁能在LLM的长度限制内处理。移植模块利用LLM将补丁适配到硬分叉，LLM能够提取超越实现差异的共同补丁逻辑，在语义层面自动化移植。

为有效指导LLM进行补丁移植，作者设计了提示模板以实现高效的上下文学习（ICL），并提出基于指令微调的训练任务，进一步引导LLM移植补丁并注入项目特定知识。评估在2022年6月之后从Vim移植到Neovim的310对补丁上进行，采用准确率、平均编辑距离（AED）和相对编辑距离（RED）作为评估指标。

## 关键实验发现
- RQ1（有效性）：PPatHF能正确移植42.3%的补丁（语法等价），自动化57%的手动编辑量，显著优于所有基线方法
- RQ2（安全补丁）：案例研究验证了PPatHF在移植安全补丁方面的有效性
- RQ3（泛化性）：在另外两对硬分叉上的评估验证了PPatHF的泛化能力
- 实证发现：Neovim近十年持续从Vim移植补丁，超过45%的总补丁和75%的安全补丁已被移植

## 写作特征备注
- 标题结构：动作+任务描述（Automating Zero-Shot Patch Porting for Hard Forks）
- 摘要是否有数字：是（42.3%正确率，57%编辑自动化，310个补丁）
- 是否有RQ：是（通过实验部分的研究问题组织）
- 是否有Motivating Example：是（Section 2.1通过Vim-Neovim的具体补丁展示移植场景和挑战）
- 贡献点数量：4

## 结论
PPatHF首次实现了硬分叉间零样本补丁移植的自动化，通过LLM在语义层面理解和适配补丁，显著减少了开发者的手动移植工作量，对缓解安全补丁移植延迟具有重要实践意义。

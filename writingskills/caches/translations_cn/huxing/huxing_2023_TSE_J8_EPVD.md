# Vulnerability Detection by Learning From Syntax-Based Execution Paths of Code
# 基于语法执行路径学习的漏洞检测

**来源**: TSE 2023 | **作者**: Junwei Zhang 等

## 摘要
漏洞检测对保护软件系统至关重要。现有基于深度学习的方法面临两个问题：（1）难以从大量无关信息中区分漏洞相关信息；（2）处理长代码效果不佳，因为神经模型通常限制输入长度。本文提出将代码片段的语法控制流图（CFG）分解为多条执行路径来检测漏洞。具体而言，先基于AST构建语法CFG，将其分解为从入口到出口的多条路径，然后使用预训练代码模型和CNN学习路径表示。在包含231k+代码片段（24k漏洞）的数据集上，EPVD在精确率、召回率和F1值方面分别比SOTA基线提升至少22.30%、42.92%和32.58%。

## 引言核心
- 漏洞检测系统在软件安全中至关重要，新发现漏洞数量近年快速增长
- 现有DL方法难以从大量无关信息中聚焦漏洞相关特征（如缓冲区溢出仅与使用缓冲区的代码相关）
- 现有DL方法处理长代码效果差，如CodeBERT仅保留前400个token，直接截断其余部分
- 代码片段通常包含多条执行路径，但往往只有少数路径存在漏洞
- 将代码分解为执行路径可过滤无关信息，且分解后的路径通常比原始代码短，不易超出模型长度限制

## 方法概述
EPVD首先将代码片段解析为AST，基于AST构建语法CFG，其中每个节点代表一条语句，每条边代表两条语句间的控制依赖关系。然后使用贪心路径选择算法从CFG中选择固定数量的从入口到出口的执行路径。每条路径输入预训练代码模型（CodeBERT）捕获路径内注意力并学习特征向量。

进一步采用CNN捕获路径间注意力，融合多条路径的表示生成代码表示。最后使用MLP分类器基于代码表示检测漏洞。这种方法的优势在于：执行路径是具有简单线性结构的内聚单元，有助于模型聚焦相关上下文信息；每条路径比完整代码短，尾部信息更可能被处理而非截断。

## 关键实验发现
- RQ1（有效性）：EPVD在精确率、召回率和F1值方面分别比最佳基线提升22.30%、42.92%和32.58%
- RQ2（分析）：进一步分析证明了EPVD在处理含大量无关信息的漏洞代码和长代码方面的有效性

## 写作特征备注
- 标题结构：描述性标题（Vulnerability Detection by Learning From Syntax-Based Execution Paths of Code）
- 摘要是否有数字：是（231k代码片段、24k漏洞、22.30%、42.92%、32.58%）
- 是否有RQ：是
- 是否有Motivating Example：是（Section III包含动机和预备知识）
- 贡献点数量：4

## 结论
EPVD通过将代码分解为语法执行路径，有效解决了现有漏洞检测方法在处理无关信息和长代码方面的局限性，在大规模数据集上显著超越所有基线方法，并公开了复现包。

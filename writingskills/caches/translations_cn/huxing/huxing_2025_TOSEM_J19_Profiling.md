# Towards On-The-Fly Code Performance Profiling
# 面向即时代码性能分析

**来源**: TOSEM 2025 | **作者**: Xing Hu 等

## 摘要
提升软件应用性能是软件演化和维护中最重要的任务之一。在Intel微架构中，CPU采用流水线技术以尽可能高效地利用资源，某些软件模式或算法可能导致CPU流水线效率低下。现有技术（如Intel VTune Profiler）通常在软件进入生产环境后才检测性能问题，需要开发者手动分析监控数据并执行额外测试。本文提出了一种名为PGProf的新方法，利用图神经网络学习C函数的语义和结构表示，在开发过程中预测CPU流水线指标，实现即时性能分析。实验结果表明，PGProf在R2@5%和R2@10%指标上分别达到49.90%和79.44%，相比基线方法提升了8.0%-42.7%和7.8%-20.1%。

## 引言核心
- CPU流水线利用率分析对识别硬件级性能问题至关重要，但传统profiling需要在运行时收集数据，耗时耗力
- 现有profiling技术要求开发者构建、部署、测试、执行和监控软件，成本高昂
- 本文提出"即时性能分析"概念，在开发阶段（如IDE中）即可预测CPU流水线指标
- 将源代码表示为融合AST、CFG和DFG的程序图，利用门控图神经网络进行学习
- 将性能预测建模为分布估计任务，预测Retiring、Bad Speculation、Front-end Bound和Back-end Bound四个指标

## 方法概述
PGProf包含三个阶段：程序图构建、模型训练和在线应用。在程序图构建阶段，将给定程序的AST（抽象语法树）、CFG（控制流图）和DFG（数据流图）融合为一个程序图。然后，在从GitHub挖掘的62个C项目中提取的C函数上训练图神经网络模型，使用Intel VTune获取这些函数的流水线指标作为训练标签。

在线预测阶段，对于给定的C函数，将其输入训练好的PGProf模型以估计性能指标。该方法将预测目标建模为分布估计任务，需要生成四个加和为100%的值。通过门控图神经网络（GGNN）捕获C函数的表示，自动估计最终的流水线值。

## 关键实验发现
- RQ1（预测准确性）：PGProf在R2@5%和R2@10%指标上分别达到49.90%和79.44%的绝对结果
- RQ2（与基线对比）：相比多个基线方法，PGProf在R2@5%上提升8.0%-42.7%，在R2@10%上提升7.8%-20.1%，证明了融合多种代码结构的有效性

## 写作特征备注
- 标题结构：目标导向型（Towards...）
- 摘要是否有数字：是（49.90%、79.44%、8.0%-42.7%等）
- 是否有RQ：是
- 是否有Motivating Example：是（Alice使用场景）
- 贡献点数量：3

## 结论
PGProf通过融合多种代码结构的图神经网络，实现了在开发阶段即时预测CPU流水线性能指标，为开发者提供了无需执行代码即可获取性能反馈的新途径。

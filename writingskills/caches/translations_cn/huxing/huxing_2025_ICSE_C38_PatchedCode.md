# Similar but Patched Code Considered Harmful – The Impact of Similar but Patched Code on Recurring Vulnerability Detection and How to Remove Them
# 相似但已修补的代码危害性研究——相似但已修补代码对重复漏洞检测的影响及消除方法

**来源**: ICSE 2025 | **作者**: Zixuan Tan 等

## 摘要
识别重复漏洞对保障软件安全至关重要。基于克隆的检测技术虽被广泛使用，但由于"相似但已修补"（SBP）代码的存在，常产生大量误报。SBP代码与漏洞代码高度相似，但因已被修补而不再存在漏洞。本文提出了一个编程语言无关的框架FVF（Fixed Vulnerability Filter），通过分析代码变更历史来精确识别和过滤SBP实例，从而减少误报。实验表明，FVF能够识别并过滤四种漏洞检测工具65.1%的误报，且不产生假阳性。此外，作者将FVF应用于1,081个真实项目，构建了包含6,827个SBP函数的数据集，并证明了四种最先进的深度学习漏洞检测方法在该数据集上表现不佳（误报率均超过62%）。

## 引言核心
- 代码复用导致漏洞在下游软件中传播，如CVE-2017-12652影响了超过60,000个开源项目
- 基于克隆的漏洞检测方法难以区分漏洞代码与其修补版本（SBP），导致大量误报（总体误报率76.2%）
- 现有方法如MVP的签名方案具有编程语言特定性，缺乏通用性，且无法处理回退类型的SBP
- 深度学习方法同样无法有效区分SBP与真实漏洞，现有数据集（如Devign、Big-Vul）忽略了SBP代码的纳入
- SBP现象在真实世界中普遍存在，40%的被研究开源项目包含至少一个SBP实例

## 方法概述
FVF框架由四个核心组件构成：函数变更日志生成器、漏洞补丁日志查找器、漏洞特征数据库和修复行为匹配器。其核心思想是利用代码变更历史来判断检测到的潜在漏洞代码是否已被修补。当漏洞检测器识别出潜在漏洞函数时，FVF查询漏洞特征数据库获取补丁日志，同时检索目标代码的函数变更日志。如果补丁日志中的修复行为在函数变更日志中被检测到，则表明该代码已被修补，属于误报。

FVF作为现有漏洞检测方法的后处理步骤，支持多种检测器类型（字符串匹配、签名方法、切片技术等），具有广泛的适用性。为提高效率，FVF设置了检索窗口限制历史回溯深度，并在函数级检索不足时补充文件级变更历史。

## 关键实验发现
- RQ1（FVF有效性）：FVF将四种克隆检测工具的总体误报率从76.2%降至26.6%，改善率达49.6%，且未产生假阳性
- RQ2（SBP普遍性）：在1,081个真实项目中收集到6,824个SBP函数，40%的项目包含至少一个SBP实例
- RQ3（对DL方法的影响）：四种深度学习方法在SBP数据集上误报率均超过62%，token-based方法几乎将所有SBP误判为漏洞
- RQ4（SBP分类）：238个SBP代码被归类为三种类别，揭示了克隆检测方法混淆的根本原因

## 写作特征备注
- 标题结构：问题陈述型（"Considered Harmful"经典句式 + 副标题说明影响与解决方案）
- 摘要是否有数字：是（65.1%、6,827、1,081、76.2%、26.6%等）
- 是否有RQ：是（多个RQ贯穿实验评估）
- 是否有Motivating Example：是（Figure 1展示CVE-2022-1975的SBP示例）
- 贡献点数量：3

## 结论
本文首次系统研究了SBP现象及其对漏洞检测的影响，提出的FVF框架能有效识别和过滤SBP代码以减少误报，构建的真实SBP数据集为漏洞检测工具提供了更贴近实际的评估基准。

# MUT: Human-in-the-Loop Unit Test Migration
# MUT：人机协同的单元测试迁移

**来源**: ICSE 2024 | **作者**: Yi Gao 等

## 摘要
测试迁移能够跨平台和编程语言复用测试人员精心设计的测试用例，在移动应用测试中已展现有效性，但源代码级别的单元测试迁移尚未得到充分关注。本文提出了一种跨语言、跨平台的测试迁移方法MUT，包含代码映射、测试用例过滤、测试用例翻译和测试用例适配四个模块。MUT通过解析代码生成语法树并逐节点转换，将Java单元测试迁移为C++测试。在五个功能领域的开源项目上，共迁移550个单元测试并提交pull request，其中253个已被合并（包括Luliyucoordinate-LeetCode的197个和Rangerlee-HtmlParser的56个），通过运行这些测试发现了5个bug和2个功能缺陷。

## 引言核心
- 开发者花费大量时间手动编写单元测试，现有自动生成工具主要面向Java和Python
- C++程序的单元测试生成因语言复杂性（动态内存分配、指针运算等）而极具挑战
- 许多功能相同的软件产品用不同编程语言实现（如Android用Java，OpenHarmony用C/C++）
- 现有随机测试方法生成的测试数据和逻辑可能缺乏实际意义，限制了有效性
- 跨语言单元测试迁移面临两大挑战：建立代码映射关系和实际迁移单元测试

## 方法概述
MUT的迁移过程分为四个步骤。第一步代码映射：提取源项目和目标项目的基本代码信息（类名、方法名、参数等），通过预处理消除代码风格差异，设计API映射策略识别功能相似的代码片段对，建立类、方法和字段的映射规则。第二步测试用例过滤：分析测试方法与焦点方法的调用关系，识别源项目中可迁移的单元测试。

第三步测试用例翻译：基于BNF（巴科斯-诺尔范式）规则，使用代码翻译和替换组件将Java单元测试翻译为C++单元测试（从JUnit到GTest框架）。BNF解析保证了代码翻译的可行性和高质量。第四步测试用例适配：对翻译后的测试用例进行适配以便在目标项目中编译和执行。此外，MUT开发了Web界面展示API匹配关系和迁移前后的测试用例，支持开发者确认、修改或拒绝迁移结果。

## 关键实验发现
- RQ1（有效性）：在15个开源项目上成功迁移550个测试用例，253个已被合并到目标项目，检测到7个漏洞
- RQ2（用户研究）：用户对MUT在帮助高效编写测试用例方面表示满意

## 写作特征备注
- 标题结构：工具名:描述（MUT: Human-in-the-Loop Unit Test Migration）
- 摘要是否有数字：是（550个测试、253个合并、197个、56个、5个bug、2个缺陷）
- 是否有RQ：是
- 是否有Motivating Example：是（Jsoup到Mylogin-Htmlparser的测试迁移示例）
- 贡献点数量：3

## 结论
MUT通过跨语言代码映射和基于BNF的测试翻译，实现了从Java到C++的单元测试迁移，在实际开源项目中成功合并了253个测试用例并发现了7个漏洞，验证了测试迁移的可行性和实用价值。

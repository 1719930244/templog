# Automating User Notice Generation for Smart Contract Functions
# 智能合约函数用户通知自动生成

**来源**: ASE 2021 | **作者**: Xing Hu 等

## 摘要
智能合约在自动化金融和商业交易中至关重要。终端用户可以通过用户通知（user notice）了解智能合约函数的交易行为，但由于时间限制或缺乏动力，用户通知在开发过程中经常缺失。本文提出了SmartDoc方法，利用Transformer和Pointer机制自动为智能合约函数生成用户通知。由于智能合约标注数据有限（仅7,878个函数-通知对），作者采用迁移学习技术，将Java代码注释生成的知识迁移到Solidity用户通知生成任务中。实验结果表明SmartDoc在BLEU和ROUGE-L指标上显著优于基线方法。

## 引言核心
- 智能合约终端用户通常是非技术人员，需要用户通知来理解交易行为和评估金融风险
- Solidity官方指南建议为所有公共接口添加用户通知，但开发者经常忽略这一实践（仅4%的函数有用户通知）
- 智能合约部署后不可修改，因此无法事后补充用户通知
- 用户通知支持动态表达式机制，需要从源代码中正确复制变量名
- 相比Java等主流语言，智能合约的标注数据极为有限（数据饥饿问题）

## 方法概述
SmartDoc主要包含三个阶段：预训练、微调和应用。在预训练阶段，利用Hu等人准备的Java数据集预训练模型，因为Solidity和Java在编码规范和语法上具有相似性。在微调阶段，使用收集的7,878个智能合约函数-通知对进行微调。

模型核心采用Transformer架构并集成Pointer机制。Transformer能够捕获代码token之间的长距离依赖关系，而Pointer机制允许模型在生成过程中直接从源代码中复制token（如变量名），以满足用户通知的动态表达式需求。迁移学习策略有效缓解了标注数据不足的问题。

## 关键实验发现
- RQ1（有效性）：SmartDoc在BLEU和ROUGE-L指标上优于attendgru、ast-attendgru和Re2Com等基线方法
- RQ2（人工评估）：从自然性、信息量和相似性三个方面评估，SmartDoc均优于基线
- RQ3（迁移学习）：预训练+微调策略有效提升了模型在小规模数据上的表现
- 附加发现：拥有更多用户通知的智能合约倾向于拥有更多交易量

## 写作特征备注
- 标题结构：动名词短语（Automating User Notice Generation for Smart Contract Functions）
- 摘要是否有数字：是（7,878对、54,739合约）
- 是否有RQ：否（按实验主题组织）
- 是否有Motivating Example：是（Figure 1和Figure 2展示了智能合约函数及用户交互示例）
- 贡献点数量：4

## 结论
SmartDoc是首个针对智能合约用户通知生成的方法，通过Transformer+Pointer机制和迁移学习有效解决了动态表达式和数据稀缺两大挑战，帮助终端用户更好地理解智能合约并评估金融风险。

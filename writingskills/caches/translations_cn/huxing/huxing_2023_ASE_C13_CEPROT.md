# Identify and Update Test Cases when Production Code Changes: A Transformer-based Approach
# 当生产代码变更时识别和更新测试用例：一种基于Transformer的方法

**来源**: ASE 2023 | **作者**: Xing Hu 等

## 摘要
软件测试是软件生命周期中最重要的部分之一，测试用例应随生产代码共同演化。然而由于项目进度紧张等原因，测试用例的共同演化经常失败，过时的测试用例增加维护成本且可能无法发现缺陷。本文提出CEPROT方法，包含两个阶段：过时测试识别和测试更新。CEPROT利用预训练的CodeT5模型学习生产代码变更与测试用例之间的语义关联。实验表明CEPROT能以98.3%精确率和90.0%召回率识别过时测试，12.3%的更新测试与真实值完全一致，48.0%的更新测试可编译，平均覆盖率达34.2%（比过时测试提升89%）。

## 引言核心
- 生产代码变更后测试用例应同步更新，但实践中共同演化经常缺失
- 过时测试用例可能无法测试新版本代码，甚至引入bug（如Conekta项目API版本更新后测试延迟2年多才更新）
- 现有方法（如SITAR）在预测测试是否需要更新方面表现最差，且仅做识别不做更新
- 需要一种端到端的方法同时完成过时测试识别和自动更新
- 表示生产代码变更和学习代码变更与测试之间的语义关联是两大技术挑战

## 方法概述
CEPROT包含三个阶段：输入构建、模型训练和在线应用。输入构建阶段，将原始方法和更新方法的代码token进行词级对齐，构建编辑序列（包含equal、insert、delete、replace四种编辑动作），以细粒度表示生产代码变更。

模型训练阶段分两个子阶段：过时测试识别（二分类任务）和过时测试更新（序列到序列生成任务）。两个阶段均基于预训练的CodeT5模型进行微调。识别阶段输入编辑序列和原始测试，预测测试是否需要更新；更新阶段仅使用正样本训练，将新测试作为生成目标。在线应用阶段，两个阶段级联工作：先识别是否过时，若是则自动生成更新后的测试。

## 关键实验发现
- RQ1（识别有效性）：CEPROT在Precision（98.3%）、Recall（90.0%）和F1-score上均优于三个基线
- RQ2（更新有效性）：CEPROT在Accuracy和CodeBLEU上显著优于两个基线，12.3%的更新测试与真实值完全一致
- RQ3（动态评估）：48.0%的更新测试可编译，平均覆盖率34.2%，比过时测试提升89%
- RQ4（人工评估）：从业者认为CEPROT能生成高质量的、与生产代码变更共同演化的测试用例

## 写作特征备注
- 标题结构：描述性短语（Identify and Update Test Cases when Production Code Changes: A Transformer-based Approach）
- 摘要是否有数字：是（98.3%、90.0%、12.3%、48.0%、34.2%、89%）
- 是否有RQ：否（按实验主题组织，但有明确的评估维度）
- 是否有Motivating Example：是（Figure 1展示了Conekta项目中过时测试的真实案例）
- 贡献点数量：3

## 结论
CEPROT首次提出端到端的生产-测试代码共同演化方法，通过编辑序列表示和CodeT5模型有效识别和更新过时测试用例，在静态评估、动态评估和人工评估中均展现了良好的效果。
